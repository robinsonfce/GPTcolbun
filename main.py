from langchain.chat_models import ChatOpenAI
from langchain.chains import ConversationChain
from langchain.chains.conversation.memory import ConversationBufferWindowMemory
from langchain.prompts import (
    SystemMessagePromptTemplate,
    HumanMessagePromptTemplate,
    ChatPromptTemplate,
    MessagesPlaceholder
)

import openai
from streamlit_chat import message
from utils import *


from dotenv import load_dotenv
import os


import streamlit as st

# Define las variables de entorno y otros secrets

st.write("Clave de API de OpenAI:", OPENAI_API_KEY)
st.write("Otra variable:", PINECONE_API_KEY)
class Document:
    def __init__(self, page_content, metadata):
        self.page_content = page_content
        self.metadata = metadata

    def __repr__(self):
        return f"Document(page_content='{self.page_content}', metadata={self.metadata})"

    __str__ = __repr__


st.markdown("<h2 style='text-align: center;'>Consulta lo que desees sobre seguridad y reglamentos de Colbun</h2>", unsafe_allow_html=True)

st.markdown(
    """
    <img src="data:image/jpeg;base64,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" width="100" align="middle">
    """,
    unsafe_allow_html=True,
)

st.markdown("<h6 style='text-align: center;'>Creado por: Robinson Cornejo</h6>", unsafe_allow_html=True)


if 'responses' not in st.session_state:
    st.session_state['responses'] = ["En que puedo ayudarte hoy"]

if 'requests' not in st.session_state:
    st.session_state['requests'] = []

llm = ChatOpenAI(model_name="gpt-3.5-turbo", openai_api_key=OPENAI_API_KEY)

if 'buffer_memory' not in st.session_state:
            st.session_state.buffer_memory=ConversationBufferWindowMemory(k=3,return_messages=True)


system_msg_template = SystemMessagePromptTemplate.from_template(
    template="""Responda la pregunta con la mayor veracidad posible utilizando el contexto proporcionado,
y si la respuesta no está contenida en el texto a continuación, diga 'Podrias preguntarle al equipo MASSO, seguramente ellos podran orientarte' """)


human_msg_template = HumanMessagePromptTemplate.from_template(template="{input}")

prompt_template = ChatPromptTemplate.from_messages([system_msg_template, MessagesPlaceholder(variable_name="history"), human_msg_template])

conversation = ConversationChain(memory=st.session_state.buffer_memory, prompt=prompt_template, llm=llm, verbose=True)




# container for chat history
response_container = st.container()
# container for text box
textcontainer = st.container()


with textcontainer:
    query = st.text_input("Consulta: ", key="input")
    if query:
        with st.spinner("Escribiendo..."):
            conversation_string = get_conversation_string()
            st.code(conversation_string)
            #user_entities = extract_entities(query)
            #print("#######")
            #print(user_entities)
            refined_query = query_refiner(conversation_string, query)
            #st.subheader("Refined Query:")
            #st.write(refined_query)
            context = get_answer(refined_query)
            print(context)  
            response = conversation.predict(input=f"Context:\n {context} \n\n Query:\n{query}")
        st.session_state.requests.append(query)
        st.session_state.responses.append(response) 
with response_container:
   if st.session_state['responses']:
        pass
       
           

          
